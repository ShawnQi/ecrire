<%= content_tag :header, as: "Post.Header", href: admin_post_image_path(@post), method: 'POST' do |header| %>
  <% if @post.header? %>
    <% header[:style] = "background-image: url(#{@post.header.url});" %>
  <% end %>
  <div class='drop'>

    <%= render 'admin/posts/header/dropping', css: %w(status dropping hidden) %>
    <%= render 'admin/posts/header/uploading', css: %w(status uploading hidden) %>
    <%= render 'admin/posts/header/error', css: %w(status error hidden) %>
  </div>

  <div class='title'>

    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class='toggle', as='Navigation.Toggle' x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve">
      <path d="M4.516,7.548c0.436-0.446,1.043-0.481,1.576,0L10,11.295l3.908-3.747c0.533-0.481,1.141-0.446,1.574,0  c0.436,0.445,0.408,1.197,0,1.615c-0.406,0.418-4.695,4.502-4.695,4.502C10.57,13.888,10.285,14,10,14s-0.57-0.112-0.789-0.335  c0,0-4.287-4.084-4.695-4.502C4.107,8.745,4.08,7.993,4.516,7.548z"/>
    </svg>
    <%= content_tag :svg,
      method: 'DELETE',
      href: admin_post_image_path(@post),
      class: %w(clear),
      version: "1.1",
      xmlns: "http://www.w3.org/2000/svg",
      'xmlns:xlink' => "http://www.w3.org/1999/xlink",
      x: "0px",
      y: "0px",
      viewBox: "0 0 20 20",
      'enable-background' => "new 0 0 20 20",
      'xml:space' => "preserve" do |svg| %>

      <% if !@post.header? %>
        <% svg.css << 'hidden' %>
      <% end %>

        <path d="M16,2H4C2.9,2,2,2.9,2,4v12c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V4C18,2.9,17.1,2,16,2z M13.061,14.789L10,11.729
    	   l-3.061,3.06l-1.729-1.728L8.271,10L5.211,6.939l1.729-1.729L10,8.271l3.059-3.061l1.729,1.729L11.729,10l3.06,3.061L13.061,14.789z
    	    "/>
    <% end %>
    <%= content_tag :div, @post.title, contenteditable: true, as: 'Posts.Title' %>
    <input type='file' />
    <p class='browse'>Set a header image. Either <strong>drop</strong> an image here or <strong>select an image</strong>.</p>
  </div>

<% end %>

<section>

  <%= content_tag :div, class: %w(publish state), href: admin_post_path(@post.id), as: 'Post.Sticky' do %>

    <% if @post.published? %>

      <%= form_for @post, method: :put, html: { class: %w(hide button destroy) } do |f| %>
        <%= f.button 'Retract', value: 'unpublish'%>
      <% end %>

    <% else %>

      <%= form_for @post, method: :put, html: { id: 'PublishPost', class: %w(button publish) } do |f| %>
        <%= f.button 'Publish', value: 'publish'%>
      <% end %>

      <%= form_for @post, method: :delete, html: { id: 'DeletePost', class: %w(destroy button), as: 'Post.Delete' } do |f| %>
        <%= f.button disabled: true do %>
          <%= check_box_tag 'delete' %>
          Delete this post
        <% end %>
      <% end %>

    <% end %>

  <% end %>

  <article>
    <%= post_edit_content(@post) %>
  </article>

  <div class='save' as='Post.Sticky'>
    <%= form_for @post, method: :put, remote: true, html: {as: 'Editor.Save', class: %w(save button)} do |f| %>
      <%= f.button '', dirty: 'Update', persisted: 'Up to date', disabled: true %>
      <%= content_tag :div, class: %w(update) do %>
        Last updated
        <%= content_tag :p, nil, time: @post.updated_at.iso8601 %>
      <% end %>
    <% end %>

    <%= link_to 'Syntax', help_admin_posts_path, remote: true, class: %w(help), as: 'Post.Documentation' %>

    <% unless Rails.application.secrets.has_key?(:s3) %>
      <div class='s3 configuration missing'>
        <%= link_to 'Configure S3 to upload images.', admin_configurations_images_path %>
      </div>
    <% end %>
  </div>

</section>
